<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Petal Pounce | Pixel Nature</title>
    <style>
        /* This CSS makes everything look like Retro Pixels */
        canvas { 
            display: block; 
            margin: 0 auto; 
            background: #87CEEB; 
            image-rendering: pixelated; 
            width: 100vw; 
            height: 100vh;
            touch-action: none;
        }
        body { margin: 0; background: #333; overflow: hidden; font-family: 'Courier New', Courier, monospace; }
        
        #ui {
            position: absolute; top: 10px; left: 10px; color: white;
            pointer-events: none; text-shadow: 2px 2px 0px #000;
            font-size: 18px; z-index: 5;
        }

        #overlay {
            position: absolute; inset: 0; background: rgba(135, 206, 235, 0.8);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10; text-align: center;
        }

        .pixel-btn {
            background: #ffcc00; border: 4px solid #000; padding: 10px 20px;
            font-size: 20px; cursor: pointer; box-shadow: 4px 4px 0px #000;
        }
        .pixel-btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #000; }
    </style>
</head>
<body>

<div id="ui">
    <div id="hearts">‚ù§‚ù§‚ù§</div>
    <div id="score">PETALS: 0</div>
</div>

<div id="overlay">
    <h1 style="color: #fff; text-shadow: 4px 4px 0px #000; font-size: 40px;">PETAL POUNCE</h1>
    <p style="font-weight: bold;">Jump on Clouds! Collect Flowers!</p>
    <button class="pixel-btn" onclick="startGame()">START HOPPING</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/** * PETAL POUNCE - PIXEL ENGINE
 * Low-res canvas scaled up creates the pixel art look
 */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const heartsEl = document.getElementById('hearts');
const overlay = document.getElementById('overlay');

// Internal resolution for pixel look
const GAME_W = 320;
const GAME_H = 480;
canvas.width = GAME_W;
canvas.height = GAME_H;

let gameActive = false;
let score = 0;
let health = 3;
let frame = 0;

const player = {
    x: 140, y: 300, w: 24, h: 20,
    vx: 0, vy: 0,
    jump: -8, gravity: 0.4,
    grounded: false
};

let clouds = [];
let flowers = [];
let storms = [];

function startGame() {
    score = 0; health = 3; frame = 0;
    clouds = []; flowers = []; storms = [];
    player.x = 140; player.y = 300; player.vy = 0;
    
    // Starting platforms
    for(let i=0; i<6; i++) {
        clouds.push({ x: Math.random()*240, y: i*80 + 50, w: 60, h: 16 });
    }
    
    gameActive = true;
    overlay.style.display = 'none';
    updateUI();
}

// Controls
let moveX = 0;
window.addEventListener('keydown', e => {
    if(e.code === 'ArrowLeft') moveX = -3;
    if(e.code === 'ArrowRight') moveX = 3;
});
window.addEventListener('keyup', () => moveX = 0);

// Mobile Touch
window.addEventListener('touchstart', e => {
    const touchX = e.touches[0].clientX;
    if(touchX < window.innerWidth/2) moveX = -3;
    else moveX = 3;
});
window.addEventListener('touchend', () => moveX = 0);

function updateUI() {
    scoreEl.innerText = `PETALS: ${score}`;
    heartsEl.innerText = "‚ù§".repeat(health);
}

function update() {
    if(!gameActive) return;
    frame++;

    // Player Physics
    player.vy += player.gravity;
    player.x += moveX;
    player.y += player.vy;

    // Boundary
    if(player.x < 0) player.x = GAME_W;
    if(player.x > GAME_W) player.x = 0;

    // Platform Collision (Pixel Style)
    player.grounded = false;
    clouds.forEach(c => {
        if(player.vy > 0 && player.x + player.w > c.x && player.x < c.x + c.w &&
           player.y + player.h > c.y && player.y + player.h < c.y + c.h + player.vy) {
            player.vy = player.jump;
        }
        c.y += 1; // Clouds move down
        if(c.y > GAME_H) {
            c.y = 0;
            c.x = Math.random() * (GAME_W - 60);
        }
    });

    // Items Spawn
    if(frame % 100 === 0) {
        flowers.push({ x: Math.random()*GAME_W, y: -20, type: Math.random() > 0.5 ? 'üåª' : 'üåº' });
    }
    if(frame % 250 === 0) {
        storms.push({ x: Math.random()*GAME_W, y: -20 });
    }

    // Flower Collection
    flowers.forEach((f, i) => {
        f.y += 2;
        if(Math.hypot(player.x - f.x, player.y - f.y) < 20) {
            flowers.splice(i, 1);
            score += 50;
            updateUI();
        }
    });

    // Storm Damage
    storms.forEach((s, i) => {
        s.y += 3;
        if(Math.hypot(player.x - s.x, player.y - s.y) < 20) {
            storms.splice(i, 1);
            health--;
            updateUI();
            if(health <= 0) endGame(false);
        }
    });

    if(player.y > GAME_H) endGame(false);
    if(score >= 1000) endGame(true);
}

function draw() {
    ctx.clearRect(0, 0, GAME_W, GAME_H);

    // Pixel Clouds
    ctx.fillStyle = "white";
    clouds.forEach(c => {
        ctx.fillRect(c.x, c.y, c.w, c.h);
        ctx.fillRect(c.x + 10, c.y - 5, c.w - 20, 5); // Simple cloud shape
    });

    // Pixel Flowers
    ctx.font = "20px Arial";
    flowers.forEach(f => ctx.fillText(f.type, f.x, f.y));

    // Pixel Storms
    storms.forEach(s => ctx.fillText('‚òÅÔ∏è‚ö°', s.x, s.y));

    // Pixel Bunny (Player)
    ctx.fillStyle = "#8a2be2"; // Purple Bunny
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = "white";
    ctx.fillRect(player.x + 15, player.y + 4, 4, 4); // Eye
    ctx.fillStyle = "#ff69b4";
    ctx.fillRect(player.x - 4, player.y - 10, 6, 15); // Ear 1
    ctx.fillRect(player.x + 4, player.y - 10, 6, 15); // Ear 2
}

function endGame(win) {
    gameActive = false;
    overlay.style.display = 'flex';
    if(win) {
        overlay.innerHTML = `
            <h1 style="color: #ff69b4;">YOU WON!</h1>
            <div style="font-size: 80px;">üíã</div>
            <p>Nature loves you! Here is your smooch.</p>
            <button class="pixel-btn" onclick="startGame()">PLAY AGAIN</button>
        `;
    } else {
        overlay.innerHTML = `
            <h1>OH NO!</h1>
            <p>The bunny fell or got struck!</p>
            <button class="pixel-btn" onclick="startGame()">TRY AGAIN</button>
        `;
    }
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>